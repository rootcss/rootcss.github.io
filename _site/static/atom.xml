<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  
    <title type="text" xml:lang="en">Shekhar Singh - Tech, Data, Fitness, Books - rootcss</title>
    <link type="application/atom+xml" rel="self" href="http://localhost:3000/atom.xml"/>
  
  <link href="http://localhost:3000/"/>
  <id>http://localhost:3000/</id>
  <updated>2020-04-25T20:57:29Z</updated>
  <author>
    <name>Shekhar Singh</name>
    <email>shekhar [.] singh [@] msn [.] com</email>
  </author>
  <rights type="text">Copyright © 2020 Shekhar Singh. All rights reserved.</rights>
  
  <entry>
  <title type="text">Deploying a service on Kubernetes locally using Terraform</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2020/04/19/deploying-a-service-on-kubernetes-locally-using-terraform.html" />
  <id>http://localhost:3000/blog/2020/04/19/deploying-a-service-on-kubernetes-locally-using-terraform</id>
  <published>2020-04-19T00:00:00Z</published>
  <updated>2020-04-19T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>A couple of weeks back, I was trying to debug a Helm chart, but wasn’t able to iterate and test the changes as fast as I wanted to. In such situation, I always prefer to test things on my own setup (usually on local machine) - for which I needed Kubernetes locally too. When I started installing minikube using official documentation, it didn’t work in my first attempt because of a couple of errors related to Hypervisor and Virtualbox. Also, my debugging required me to use terarform and a custom application, hence this blog post :)</p>

<p>In this post, we’ll deploy a small Go service on Kubernetes using Terraform, locally.</p>

<p>Versions:</p>
<div class="language-config highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">MacOS</span>: <span class="m">10</span>.<span class="m">15</span>.<span class="m">4</span>
<span class="n">docker</span>: <span class="m">19</span>.<span class="m">03</span>.<span class="m">8</span>
<span class="n">kubectl</span>: <span class="n">client</span> <span class="n">v1</span>.<span class="m">15</span>.<span class="m">5</span>, <span class="n">server</span> <span class="n">v1</span>.<span class="m">14</span>.<span class="m">10</span>-<span class="n">gke</span>.<span class="m">17</span>
<span class="n">go</span>: <span class="m">1</span>.<span class="m">13</span>.<span class="m">9</span>
<span class="n">minikube</span>: <span class="n">v1</span>.<span class="m">9</span>.<span class="m">2</span>
<span class="n">terraform</span>: <span class="n">v0</span>.<span class="m">12</span>.<span class="m">24</span>
</code></pre></div></div>

<p>You can install <a target="_blank" href="https://www.docker.com/products/docker-desktop">docker</a> and <a target="_blank" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a> first.</p>

<h2 id="installing-minikube">Installing Minikube</h2>
<p>Minikube helps us run a single-node Kubernetes cluster locally. You can go through full installation details <a target="_blank" href="https://kubernetes.io/docs/tasks/tools/install-minikube/">here</a>. The prerequisite to run minikube is a hypervisor for your system. Most modern systems have virtualization enabled by default, which you can verify using this command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># for macOS</span>
<span class="nv">$ </span>sysctl <span class="nt">-a</span> | <span class="nb">grep</span> <span class="nt">-E</span> <span class="nt">--color</span> <span class="s1">'machdep.cpu.features|VMX'</span>
</code></pre></div></div>
<p>If you see VMX highlighted in the output, it’s enabled for you. Hypervisor is the software that lets you run VM on an existing system. We’re going to use <a href="https://github.com/moby/hyperkit" target="_blank">hyperkit</a> - which is lightweight and not from Oracle 😛</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Install hyperkit</span>
<span class="nv">$ </span>brew <span class="nb">install </span>hyperkit
<span class="c"># Install minikube</span>
<span class="nv">$ </span>brew <span class="nb">install </span>minikube
<span class="c"># Start minikube with hyperkit</span>
<span class="nv">$ </span>minikube start <span class="nt">--vm-driver</span><span class="o">=</span>hyperkit
<span class="c"># Start minikube dashboard</span>
<span class="nv">$ </span>minikube dashboard
</code></pre></div></div>

<p><img class="img-responsive" src="http://localhost:3000/assets/images/k8s-dashboard.png" alt="k8s dashboard" /></p>

<p>Minikube has an isolated docker environment other than the one installed by docker. To switch to that environment, use following command. All the next commands in this shell will be run on minikube docker environment.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">eval</span> <span class="si">$(</span>minikube <span class="nt">-p</span> minikube docker-env<span class="si">)</span>
</code></pre></div></div>

<h2 id="building-a-small-service">Building a small service</h2>
<p>We’ll now quickly build a small Go application and dockerize it.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># your directory structure will look like this</span>
<span class="nv">$ </span>tree myapp
myapp
├── Dockerfile
├── Makefile
└── myapp.go
</code></pre></div></div>
<p>myapp.go</p>
<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"net/http"</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="n">http</span><span class="o">.</span><span class="n">HandleFunc</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">HelloServer</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Starting server on localhost:8080"</span><span class="p">)</span>
	<span class="n">http</span><span class="o">.</span><span class="n">ListenAndServe</span><span class="p">(</span><span class="s">":8080"</span><span class="p">,</span> <span class="no">nil</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">HelloServer</span><span class="p">(</span><span class="n">w</span> <span class="n">http</span><span class="o">.</span><span class="n">ResponseWriter</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span><span class="n">http</span><span class="o">.</span><span class="n">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Fprintf</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s">"Hello, %s!"</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">URL</span><span class="o">.</span><span class="n">Path</span><span class="p">[</span><span class="m">1</span><span class="o">:</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Makefile</p>
<div class="language-makefile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">NAME</span><span class="o">=</span>myapp
<span class="nv">VERSION</span><span class="o">=</span>0.1
<span class="nl">all</span><span class="o">:</span> <span class="nf">build</span>
<span class="nl">build</span><span class="o">:</span> <span class="nf">go build -ldflags "-X main.Version=${VERSION}" myapp.go</span>
</code></pre></div></div>

<p>Dockerfile</p>
<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> golang:1.13-stretch as base</span>
<span class="k">WORKDIR</span><span class="s"> /build/</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span><span class="o">[</span><span class="s2">"make"</span><span class="o">]</span>

<span class="k">FROM</span><span class="s"> alpine:latest</span>
<span class="k">WORKDIR</span><span class="s"> /opt/myapp</span>
<span class="k">COPY</span><span class="s"> --from=base /build/myapp /opt/myapp/bin/myapp</span>
<span class="k">RUN </span><span class="o">[</span><span class="s2">"apk"</span>, <span class="s2">"update"</span><span class="o">]</span>
<span class="k">EXPOSE</span><span class="s"> 8080</span>

<span class="k">RUN </span><span class="o">[</span><span class="s2">"apk"</span>, <span class="s2">"add"</span>, <span class="s2">"libc6-compat"</span><span class="o">]</span>
<span class="k">ENTRYPOINT</span><span class="s"> ["/opt/myapp/bin/myapp"]</span>
</code></pre></div></div>

<p>Build and start your container using following commands (you already know these):</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker build <span class="nt">-t</span> myapp:0.1 <span class="nb">.</span>
<span class="nv">$ </span>docker run <span class="nt">-p</span> 8080:8080 myapp:0.1
Starting server on localhost:8080

<span class="nv">$ </span>curl localhost:8080
Hello, <span class="o">!</span>
<span class="c"># our app is working fine.</span>
</code></pre></div></div>
<p>Now, we’ll finally write our terraform scripts to deploy this service on minikube.</p>

<h2 id="writing-the-terraform-script">Writing the Terraform script</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># here are the files that we're going to create</span>
<span class="nv">$ </span>tree deploy
deploy
├── main.tf
└── outputs.tf
</code></pre></div></div>
<p>main.tf</p>
<div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">provider</span> <span class="s2">"kubernetes"</span> <span class="p">{</span>
  <span class="nx">config_context_cluster</span>   <span class="p">=</span> <span class="s2">"minikube"</span>
<span class="p">}</span>

<span class="c1"># In kubernetes, you can deploy with different type of objects</span>
<span class="c1"># like, Pod, ReplicationController, Deployment etc.</span>
<span class="c1"># While Deployment is highly recommended for production use-cases, </span>
<span class="c1"># we'll simply use Pod object</span>
<span class="k">resource</span> <span class="s2">"kubernetes_pod"</span> <span class="s2">"myapp"</span> <span class="p">{</span>
  <span class="nx">metadata</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="p">=</span> <span class="s2">"myapp"</span>
    <span class="nx">labels</span> <span class="p">=</span> <span class="p">{</span>
      <span class="nx">App</span> <span class="p">=</span> <span class="s2">"myapp"</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="nx">spec</span> <span class="p">{</span>
    <span class="nx">container</span> <span class="p">{</span>
      <span class="nx">image</span> <span class="p">=</span> <span class="s2">"myapp:0.1"</span>
      <span class="nx">name</span>  <span class="p">=</span> <span class="s2">"myapp"</span>

      <span class="nx">port</span> <span class="p">{</span>
        <span class="nx">container_port</span> <span class="p">=</span> <span class="mi">8080</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Let's create a Service object - in simple words, this object helps</span>
<span class="c1"># you with loadbalancing and network abstraction on top of pods</span>
<span class="k">resource</span> <span class="s2">"kubernetes_service"</span> <span class="s2">"myapp"</span> <span class="p">{</span>
  <span class="nx">metadata</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="p">=</span> <span class="s2">"myapp"</span>
  <span class="p">}</span>
  <span class="nx">spec</span> <span class="p">{</span>
    <span class="nx">selector</span> <span class="p">=</span> <span class="p">{</span>
        <span class="nx">App</span> <span class="p">=</span> <span class="nx">kubernetes_pod</span><span class="p">.</span><span class="nx">myapp</span><span class="p">.</span><span class="nx">metadata</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">labels</span><span class="p">.</span><span class="nx">App</span>
    <span class="p">}</span>
    <span class="nx">port</span> <span class="p">{</span>
      <span class="nx">port</span>        <span class="p">=</span> <span class="mi">80</span>
      <span class="nx">target_port</span> <span class="p">=</span> <span class="mi">8080</span>
    <span class="p">}</span>

    <span class="nx">type</span> <span class="p">=</span> <span class="s2">"NodePort"</span> <span class="c1">#"LoadBalancer"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>outputs.tf</p>
<div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">output</span> <span class="s2">"name"</span> <span class="p">{</span>
  <span class="nx">value</span> <span class="p">=</span> <span class="s2">"</span><span class="k">${</span><span class="nx">kubernetes_pod</span><span class="p">.</span><span class="nx">myapp</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="mi">0</span><span class="p">.</span><span class="nx">name</span><span class="k">}</span><span class="s2">"</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="applying-our-infrastructure">Applying our Infrastructure</h2>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cd </span>deploy
<span class="nv">$ </span>terraform init
<span class="nv">$ </span>terraform apply
</code></pre></div></div>

<p>At this point, the service should be up and running. You can verify the pods and their status. To get the IP of your service, use the following command:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>minikube service myapp 
<span class="c"># this will open up your service in the brwoser window</span>
</code></pre></div></div>

<p><br />
In the next post, I’ll try to post about the minor issue I was facing in helm charts, that I was able to reproduce in local and finally fix it :)</p>
 ]]></content>
</entry>


  <entry>
  <title type="text">Running - The Bangalore airport solo Half Marathon 2019 - 26 km</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2019/12/22/running-the-bangalore-airport-solo-half-marathon-26-km.html" />
  <id>http://localhost:3000/blog/2019/12/22/running-the-bangalore-airport-solo-half-marathon-26-km</id>
  <published>2019-12-22T00:00:00Z</published>
  <updated>2019-12-22T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>
The Airport Run 2019 (third). This one was tougher than last year, probably because I weigh 5kg+ (planned weight gain) more since then, which I could clearly feel. They've dug a long part of the airport road, so the track is not as good now.
</p>
<p>
The shoes is the picture is now finally retired, which I used for 3 years and all the Airport runs as well. Atleast <b>2100 km</b> of running in these shoes overall.
So far I've been successful in running a half marathon (+ 5 km) airport run on last Sunday of every year for 3 consecutive years. I plan on continuing this. I ran today because of some plans on next Sunday (actual last)
</p>
<p><br /></p>
<center><img class="img-responsive" src="http://localhost:3000/assets/images/airport_run_2019.png" alt="airport_run_2019" style="width:500px;height:500px;" />
</center>
 ]]></content>
</entry>


  <entry>
  <title type="text">Cycling Trip - Mangalore to Goa across the diverse Indian west coast - 430+ km</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2019/09/25/cycling-trip-mangalore-to-panjim-goa-430-km.html" />
  <id>http://localhost:3000/blog/2019/09/25/cycling-trip-mangalore-to-panjim-goa-430-km</id>
  <published>2019-09-25T00:00:00Z</published>
  <updated>2019-09-25T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>WIP.</p>
 ]]></content>
</entry>


  <entry>
  <title type="text">Cycling Trip - Bangalore to Kolar/Avani village - 240 km in 11 hours</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2019/08/15/cycling-trip-bangalore-to-kolar-avani-240-km-in-11-hours.html" />
  <id>http://localhost:3000/blog/2019/08/15/cycling-trip-bangalore-to-kolar-avani-240-km-in-11-hours</id>
  <published>2019-08-15T00:00:00Z</published>
  <updated>2019-08-15T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p><b>Content:</b></p>
<ul>
	<li><a href="#section_1">Why this trip?</a></li>
	<li><a href="#section_2">Places &amp; temples I visited</a></li>
	<li><a href="#section_3">Hardest part: The return trip to the home</a></li>
</ul>

<p><span style="color: #ccd;"><i>Note: This post is slightly detailed. I wanted to keep it as a “Notes to self”; because I don’t want to forget some of the moments from this trip; especially the 3rd part of this post.</i></span></p>

<p id="section_1">
  It's been a couple of months, that I had gone for a long cycling trip. 15th August on a Thursday means long weekend was coming (kind of). On Wednesday, I was thinking about the places I can go; but I and my cycling partner <a href="https://twitter.com/nitishsp" target="_blank">Nitish</a> (we call him <i>Parkar</i>) had been to most Bangalore's good places in the range of around ~120 km round trip. Kolar's blue water lake (also called "Dodda" or "Chhota Ladakh") was in my mind from last few times which is roughly 52 km from Indiranagar. In the Bangalore-Sakleshpura-Chikmangaluru cycling trip (a post soon), Parkar and I had clocked our best of 135 km in a single day. I wanted to go farther than that from quite some time, but couldn't find a good destination within the range. More than that, a destination which could be safe to go; if I get tired and could crash somewhere midway.
</p>

<p>
  Therefore, I decided to visit Kolar and cover some of the nearby ancient temples that I had heard of. I created a map which included the lake and 6 temples (Targetting ~220 km). Parkar couldn't join me as he was still recovering from the viral fever. In the evening, I washed the bike, did the basic checks and packed up the small decathlon bag with all the utilities (checklist <a href="http://localhost:3000/blog/2019/06/11/long-cycling-ride-checklist-endurace-ride.html" target="_blank">here</a>). I quickly prepared my go-to mixture of roasted grams + raisins + almonds + peanuts (~500gm overall). I knew that nutrition and hydration are going to be the deciding factor. I slept at around 1 AM since Me/Parkar/Vishwas were chilling at my home; which already delayed my plan by an hour. I got up at 6 AM.
</p>

<p>
  In the morning, I had to visit Parkar's house first, to get bike's chain lube, since the bike was not serviced for a while. Then, I checked the map, plugged-in earphones, started a long playlist and set the goal to come back home by 7 PM; a total of 12.5 hours trip.
  I started cycling at good speed; so that while returning I could spare a few hours in case things go bad. I bought a small Indian flag 🇮🇳 on the way (NH 75) since many people were selling it on the way throughout for Independence Day celebration. At this point, I realized I had forgotten to tie Rakhi :-( It was Rakshabandhan too.
</p>

<center><img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/dodda_blue_water_lake.jpg" alt="Kolar dodda blue water lake" style="width:600px;height:450px;" /></center>

<h3 id="section_2">Dodda ayur Chhota Ladakh</h3>
<p>
  In less than 2 hours, I had reached the Chhota Ladakh area. It was really fun so far, good songs and speed! My water bottle fell and broke due to a sudden speed breaker that I didn't see on the way. On the other hand, I couldn't find the lake for next ~30 minutes; since it was not correctly marked on the map, and no signs, etc. I moved in the wrong direction for about 2-3 km as well and then had to come back. Finally, reached the place after asking the only farmer I could see in that small village. The lake and rocks around were unexpectedly huge. The place was all empty, apart from a security guard (claimed by him); the strong winds made it a pretty chilling place.
</p>

<p><b>Kolar &amp; Avani</b> has a very rich history. Valmiki lived here, Lav &amp; Kush were born in Avani too. There are a large number of temples in this whole region. It’s very popular for Gold fields. <a href="https://en.wikipedia.org/wiki/Kolar" target="_blank">(wiki)</a></p>

<h3>Antharagange</h3>

<p>I had my breakfast bars, some dry fruits and I left for Kolar city, which was around 11 km from here. This was my fastest 11 km; which I completed in 17 mins; but again the location was marked incorrectly on Google Maps. I had to ride a few extra kms here and there to finally find it. This place is full of monkeys (actual monkeys, I mean) and it has trek starting through a bunch of staircases to many caves through the rocks. It’s a Lord Shiva’s temple, which means “The Ganges from the deep” in Kannada. It’s also known as Kashi of South. <a href="https://en.wikipedia.org/wiki/Antara_Gange" target="_blank">(wiki)</a> I had two tender coconuts before I left from here.</p>

<center><img style="width:650px;height:600px;" class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/antharagange.jpg" alt="Antara Gange" /></center>

<h3>Someshwara &amp; Kolaramma Temples</h3>
<p>Next two temples were within the Kolar city. Most of these temples were built by <a href="https://en.wikipedia.org/wiki/Chola_dynasty" target="_blank">Cholas</a> time. I covered them quickly and wanted to grab a breakfast too. Google Maps was showing that Kolar had a big lake, but when I reached the location, it was just a dried out huge lake with plastics, and trees inside it. Imagine, this state of the lake was during the monsoon.</p>

<div style="width: 750px; height: 390px;">
	<div style="width: 510px; height: 390px;float: left;">
		<img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/sri_somehwara.jpg" alt="Someshwara Temple" style="width:510px;" />	
	</div>
	<div style="width: 235px; height: 390px;float: left; margin-top: 9px;">
		<img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/kolaramma.jpg" alt="Kotilingeshwara Temple" style="height: 365px;" />
	</div>
</div>

<p>Anyway, I realized in the search of lake and a good Dosa place, I had come out of the city on a state highway (SH 96) which took me out of the city and back to NH 75. Also, I got a call from home and got scolded for not tying the rakhi yet. I borrowed a few hours from them. <u>While cycling, you can talk to people for long.</u> :)</p>

<p>I decided to have the proper breakfast after reaching my next stop, Avani Village, which was roughly 30 km from here. Plus, I have already been snacking on the items I got with me. I had a few glasses of sugarcane juice and I started for the next stop. Although, it’s not too tough to find restaurants on highways, sometimes it can get tough in remote areas; especially on a cycle.</p>

<p>Around 25 km later, I took a right-turn into Avani village, leaving the highway - which goes to Tirupathi. I saw a board saying it was 151 km from there, and it got me thinking if I should rather go Tirupathi, but maybe next time :) This road was better, huge trees on both sides and not wide like highways. Plus, my speed has been really good so far. I reached the next temple within 1 hour 12 mins. These villages were really small. I didn’t see a lot of people. Weather was okay, not too humid or too hot.</p>

<h3>Ramalingeshwara Temples</h3>
<p>These temples were a group of many temples. They were built before Chola dynasty (10th century), who had renovated these. There were barely 5-7 people around though. I roamed around, read some of the stories on the boards, and then took a nap for 15 minutes on a huge stone under a tree. I decided to leave for the next place by 1 PM. I ate most of the <a href="https://en.wikipedia.org/wiki/Chikki" target="_blank">chikki</a> I had, drank water and left for the next place at 1 PM.</p>
<div style="width: 750px; height: 600px;">
	<div style="width: 750px; height: 285px;float: left;">
		<div style="width: 370px; height: 300px;float: left;margin-right: 5px;">
			<img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/ramalingeshwara_1.jpg" alt="Kotilingeshwara Temple" style="width:390px;" />	
		</div>
		<div style="width: 370px; height: 300px;float: left;">
			<img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/ramalingeshwara_2.jpg" alt="Kotilingeshwara Temple" style="width:390px;" />	
		</div>
	</div>
	<div style="width: 750px; height: 300px;float: left;">
		<div style="width: 370px; height: 300px;float: left;margin-right: 5px;">
			<img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/ramalingeshwara_3.jpg" alt="Kotilingeshwara Temple" style="width:390px;" />	
		</div>
		<div style="width: 370px; height: 300px;float: left;">
			<img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/ramalingeshwara_4.jpg" alt="Kotilingeshwara Temple" style="width:390px;height: 278px;" />	
		</div>
	</div>
</div>

<p>These were really bad roads. For a stretch of over 8-10 km, I went through those patchy and broken roads. I was slightly worried about the cycle, since it has only hybrid tyres, and it’s not a mountain bike. These roads took me to some very remote areas, small villages, jungles, and very dry lands. I was constantly checking maps since there were a lot of turns and I didn’t want to take some bad route. Finally, I reached the next destination in a village.</p>

<h3>Kotilingeshwara Temple</h3>
<p>Unlike, all the above temples, this temple was super crowded. Suddenly, I could see a lot of humans around. This temple is not a very old temple and is also called mini-Tirupathi. It has the largest Shivling in the world and has 10 million+ small-sized Shivlings. It looked like a huge shop at first, but these Shivlings are actually donated by the devotees.</p>
<center><img style="width:500px;" class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/kotilingeshwara.jpg" alt="Kotilingeshwara Temple" /></center>
<p>It was very crowded, and I set the time of 3 PM to start for my return trip. I had to skip the huge queue to go inside the main temple. Although they were offering free meals there, I decided to finally have my lunch outside in a local Dosa shop. Two Onion Dosas. Bought a water bottle and I left from here.
<br /></p>

<h3 id="section_3">Hardest part: The return trip to the Home</h3>
<p>I checked on the map; it was 90 km. I thought it shouldn’t take me more than 4.5 hours to reach home considering the trip so far. I’ve been feeling pretty good; except for the bad road part and was not fully tired yet.</p>

<p>After around next 4-5 km, I realized that I was riding at a slower speed for some reason, plus I started getting tired. Soon, I understood that I was going against the direction of winds, which was added trouble on those roads with so many up-and-downs. I was surprised to face such high impact of winds. My next goal was to cut into NH 75 near Kolar, which was around 32 km. This stretch was the toughest. I drank a lot of water, ate some more carbs, in that jungle-ish and dry land road. It was SH-96. I couldn’t ride well. But I thought, once I get back to the highway, I will be able to get the speed. So my goal was to just reach Kolar. By the way, I had not still tied the Rakhi. <u>I could read the notifications in my watch's screen that my family's Whatsapp group was angry at me.</u></p>

<p>It took me <b>2.5 hours</b> to finish this stretch. This drained out all my energy and suddenly I started to have lower back pain, knees + legs pain, and palms were getting numb. The pain was expected even before I started the trip. In all my previous trips, I  never had pain in my lower legs, but this time maybe because of higher speed, it caught me. I put the pain relief spray, which eventually helped with my lower back pain after 30 minutes. But the legs were in bad shape.</p>

<p>After reaching Kolar on NH 75, I had 60 km to go. Unexpectedly, within 10 km, I felt I was riding really slow. The opposing wind was still there. I was worried that I might have to ride till very late in the night on this highway, which is not safe considering there are no street lights on most part of the highways. I wanted to reach the next major stop, Hoskote. which was 40 km from Kolar. I thought I was riding at a speed of 12-13 km/hour, which was really bad. Highways are un-even, there are too many ups-and-downs, flyovers, etc; which you realize only if you’re running or cycling. <b><i>I had given up at this point.</i></b> So I planned to take a lift till Hoskote from some truck or lorry. In my first attempt, one lorry stopped, but he said, he is going to take the next immediate left, which he actually took in 50 meters. That was slightly disappointing. I checked the maps for the distance and I realized, I was averaging exactly 20 kmph. This was good news, suddenly my calculations were on the safer side, and I felt slightly motivated. My phone battery was now 20%, so <u>I had to turn off the music at this point</u>. Only Google Maps was active now.</p>

<p><b>In my head, I made a plan</b> that I’ll take a 5 minutes break, in every 30 minutes, and after every 10 km. Which means I will reach Bangalore by 7:30 PM and home before 9 PM. I broke that remaining 50 km into 5 chunks. Hoskote was 30 km from there.</p>

<p>My palms were aching and slightly numb. Legs were painful. But my plan was working. I was clocking exact 20 kmph. Meanwhile, It was getting dark, I kept dropping my location as checkpoints to Parkar/Vishwas in a Whatsapp group; and actually, asked them, <i>If I don’t call them by 9 PM, give me a call.</i> On the highway, I could see every kilometer getting reduced to Hoskote on those sideboards.</p>

<p><b>At this point, I had only the following things going in my head</b>: 1. Tie Rakhi when you reach home. 2. Cover next 10 km in 30 minutes. 3. Reach Hoskote. 4. Eminem’s <i>Till I Collapse</i> verse. I couldn’t literally think of anything else happening in my life, I couldn’t sing any songs in my head either. Usually, I love the time when I ain’t thinking about anything else. eg, during a workout, or some deep work. But this was different.</p>

<p>Soon, I could see more trucks and street lights, and therefore I knew Hoskote was close. I filled my pocket with all the remaining roasted grams + almonds etc mix I had and kept eating it. I had reached Bangalore’s outer area, with exactly as planned time. I was very happy at this point and my next goal was to reach home :) At this point, I couldn’t speak the whole Eminem’s verse in my head either: I could only say <i>Till I Collapse</i>, which sometimes I even shouted to keep myself active mentally.</p>

<p>But Bangalore’s traffic was as usual bad in the evening. I had to stop at many signals and a few traffic jams. Problem with stopping was that <i>it breaks the momentum and standing on the feet was more painful that pedaling the bicycle.</i> The last 10 km turned out to be much worse, because of traffic. I reached home at exact 8:30 PM.</p>

<p>I drank a few sips of water and crashed on the bed. I was feeling much weaker on the bed than on the cycle; maybe because I was home. I zoned out, and got up after 30 mins, I took shower, tied all 7 Rakhis and sent the photo to my family’s Whatsapp group. Two ORS, Eat Fit’s spinach soup and half-liter milk helped me feel much better after 2 hours.</p>

<p><br /></p>
<h4><i>
We can overcome any problem in life if we split the problem into small milestones/steps and just focus on one step at a time.
</i></h4>

<p><br />
Here’s the map of the trip:</p>

<center><img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/kolar_avani/map.png" alt="Map" style="width:750px;height:220px;" /></center>
<!-- https://www.google.co.in/maps/dir/Indiranagar,+Bengaluru,+Karnataka/Dodda+ayur+Chhota+Ladakh,+Arabikothanur,+Karnataka+563133/Antharagange+Main+Road,+Kuvempu+Nagar,+Kolar,+Karnataka/Sri+Someshwara+Temple,+Fort+Area,+Kolar,+Karnataka/Kolaramma+Temple,+Fort+Area,+Kolar,+Karnataka/Ramalingeshwara+Temple,+Avani,+Karnataka/Shree+Kotilingeshwara+Swamy+Temple,+Road,+Ghattakamadenahalli,+Karnataka/Indiranagar,+Bengaluru,+Karnataka/@13.116783,77.9819646,11z/data=!4m50!4m49!1m5!1m1!1s0x3bae16a418770391:0xb50f46b826501036!2m2!1d77.6408356!2d12.9783692!1m5!1m1!1s0x3badfb7c8a1d3b19:0x89e9f0e21855fe44!2m2!1d78.0241684!2d13.1148468!1m5!1m1!1s0x3badf09d2efe6ebf:0xfb33139875963da!2m2!1d78.115183!2d13.1377839!1m5!1m1!1s0x3badff7368206e87:0xd564cfd017b0d933!2m2!1d78.13823!2d13.1374815!1m5!1m1!1s0x3badf0f22254065f:0xa579ad6d50b3e353!2m2!1d78.1391205!2d13.1384881!1m5!1m1!1s0x3bad8db3dd415165:0x805925a2adc42e9!2m2!1d78.3294587!2d13.1070527!1m5!1m1!1s0x3bad94ab7b67cf47:0x1528ee14bcc9a5be!2m2!1d78.2957015!2d12.9951555!1m5!1m1!1s0x3bae16a418770391:0xb50f46b826501036!2m2!1d77.6408356!2d12.9783692!3e0 -->
 ]]></content>
</entry>


  <entry>
  <title type="text">Checklist - Long cycling ride (endurance rides)</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2019/06/11/long-cycling-ride-checklist-endurace-ride.html" />
  <id>http://localhost:3000/blog/2019/06/11/long-cycling-ride-checklist-endurace-ride</id>
  <published>2019-06-11T00:00:00Z</published>
  <updated>2019-06-11T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>
Every time I plan for a cycling trip, while preparing I always think about if I'm missing anything. This post is to fix that. I'll add a similar checklist for running and hiking as well.
</p>

<center><img class="img-responsive" src="http://localhost:3000/assets/images/cycling_trip/cycling_checklist.jpg" alt="Kolar dodda blue water lake" style="width:750px;height:400px;" /></center>

<h4>Checklist:</h4>

<p><b>For Cycle:</b><br />
<input type="checkbox" /> Cycling Helmet (<a target="_blank" href="https://www.decathlon.in/p/8500051_st-50-mountain-bike-helmet-black.html">decathlon</a>)<br />
<input type="checkbox" /> Wrench Spanner (<a target="_blank" href="https://www.amazon.in/dp/B00LGE1Z">amazon</a>)<br />
<input type="checkbox" /> 2 Cycle tyre tubes (<a target="_blank" href="https://www.decathlon.in/p/8311095_700x1825-inner-tube-80mm-presta.html">decathlon</a>)<br />
<input type="checkbox" /> Tyre levers (<a target="_blank" href="https://www.decathlon.in/p/8359629_puncture-repair-kit-and-adjustments-500-hand-pump-3-tyre-levers-1-multitool.html">decathlon</a>)<br />
<input type="checkbox" /> Multitool (<a target="_blank" href="https://www.decathlon.in/p/8359629_puncture-repair-kit-and-adjustments-500-hand-pump-3-tyre-levers-1-multitool.html">decathlon</a>)<br />
<input type="checkbox" /> Cycle Hand Pump (<a target="_blank" href="https://www.decathlon.in/p/8359629_puncture-repair-kit-and-adjustments-500-hand-pump-3-tyre-levers-1-multitool.html">decathlon</a>)<br /></p>

<p><b>For you:</b><br />
<input type="checkbox" /> Cycling gloves (<a target="_blank" href="https://www.decathlon.in/p/8327103_300-cycling-gloves-black.html">decathlon</a>)<br />
<input type="checkbox" /> Cycle foam saddle (<a target="_blank" href="https://www.decathlon.in/p/8381098_500-memory-foam-saddle-cover-size-m-black.html">decathlon</a>)<br />
<input type="checkbox" /> Cycling sunglasses (<a target="_blank" href="https://www.decathlon.in/p/8118519_arenberg-sunglasses-cycling-running-adult-yellow-category-1.html">decathlon</a>)<br />
<input type="checkbox" /> Arm UV protection cover (<a target="_blank" href="https://www.decathlon.in/p/8518751_roadr-arm-cover-uv-black.html">decathlon</a>)<br />
<input type="checkbox" /> Face mask/Headband (<a target="_blank" href="https://www.decathlon.in/p/8493103_mountain-trekking-headband-trek-500-multi-position-black.html">decathlon</a>)<br />
<input type="checkbox" /> Raincoat (<a target="_blank" href="https://www.decathlon.in/p/8300326_rain-cut-men-s-rain-hiking-jacket-black.html">decathlon</a>)<br />
<input type="checkbox" /> Earphones <br /></p>

<p><b>Others:</b><br />
<input type="checkbox" /> A small bag (waterproof if possible) (<a target="_blank" href="https://www.decathlon.in/p/8348925_arpenaz-10-ultra-compact-ultra-lightweight-backpack-blue.html">decathlon</a>)<br />
<input type="checkbox" /> Small Plastic to cover bag or carry cash<br />
<input type="checkbox" /> Some cash<br />
<input type="checkbox" /> ID proof<br />
<input type="checkbox" /> Emergency contact details<br />
<input type="checkbox" /> Power bank<br />
<input type="checkbox" /> Pain relief spray<br />
<input type="checkbox" /> Tourch<br /></p>

<p><b>Nutrition:</b><br />
<input type="checkbox" /> Breakfast bars (Yoga bars etc)<br />
<input type="checkbox" /> My favourite: Roasted Grams + Almonds + Peanuts + Raisins mix<br />
<input type="checkbox" /> Chikki and other dry fruits<br />
<input type="checkbox" /> Water bottle(s)<br />
<input type="checkbox" /> ORS / Tang etc.<br /></p>

<p><br />
Note: Make sure to get the items as per your cycle’s size. These links are mostly where I got them from.</p>

<p>Add a comment if you think I’m missing anything.</p>

 ]]></content>
</entry>


  <entry>
  <title type="text">Analyzing Python Pandas' memory leak and the fix</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2019/03/26/analyzing-pandas-memory-leak-issue-with-fix.html" />
  <id>http://localhost:3000/blog/2019/03/26/analyzing-pandas-memory-leak-issue-with-fix</id>
  <published>2019-03-26T00:00:00Z</published>
  <updated>2019-03-26T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>At <a target="_blank" href="https://getsimpl.com">Simpl</a>, we use <a target="_blank" href="https://pandas.pydata.org/">pandas</a> heavily to run a bunch of our machine learning models many of them implemented with scikit-learn. We’ve been growing rapidly and sometime back, one of the models crashed with python’s <code class="highlighter-rouge">MemoryError</code> exception. We were pretty sure that the hardware resources are enough to run the task.</p>

<p>What is the <b>MemoryError</b>? It’s an exception thrown by interpreter when not enough memory is available for creation of new python objects or for a running operation.</p>

<p>The catch here is that, it doesn’t necessarily mean “not enough memory available”. It could also mean that, there are some objects that are still not cleaned up by Garbage Cleaner (GC).</p>

<p>To test this, I wrote a very small script:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">blast</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">blast</span><span class="p">()</span>
</code></pre></div></div>

<p>Below is the distribution (Memory usage w.r.t Time) <u>before the program crashed</u> with MemoryError exception.</p>

<p><img class="img-responsive" src="http://localhost:3000/assets/images/pandas_memory_leak.png" alt="Pandas memory leak" /></p>

<p>The GC seems to be working fine, but it’s not able to clean up the objects as fast as it’s required in this case.
<br /><br /></p>

<p><b>What’s the issue?</b><br />
Python’s default implementation is <code class="highlighter-rouge">CPython</code> (<a target="_blank" href="https://github.com/python/cpython">github</a>) which is implemented in C. The problem was <a target="_blank" href="https://sourceware.org/bugzilla/show_bug.cgi?id=14827">this</a> bug; in the implementation of <code class="highlighter-rouge">malloc</code> in <code class="highlighter-rouge">glibc</code> (which is GNU’s implementation of C standard library).
<br /><br /></p>

<p><b>Issue Details</b>:<br />
<code class="highlighter-rouge">M_MXFAST</code> is the maximum size of a requested block that is served by using optimized memory containers called <code class="highlighter-rouge">fastbins</code>. <code class="highlighter-rouge">free()</code> is called when a memory cleanup of allocated space is required; which triggers the trimming of fastbins. Apparently, when <code class="highlighter-rouge">malloc()</code> is less than <code class="highlighter-rouge">M_MXFAST</code>, <code class="highlighter-rouge">free()</code> is not trimming fastbins. But, if we manually call <code class="highlighter-rouge">malloc_trim(0)</code> at that point, it should free() up those fastbins as well.</p>

<p>Here is a snippet from <code class="highlighter-rouge">malloc.c</code>’s <code class="highlighter-rouge">free()</code> implementation (alias <code class="highlighter-rouge">__libc_free</code>). (<a target="_blank" href="https://code.woboq.org/userspace/glibc/malloc/malloc.c.html#3115">link</a>)</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">p</span> <span class="o">=</span> <span class="n">mem2chunk</span> <span class="p">(</span><span class="n">mem</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">chunk_is_mmapped</span> <span class="p">(</span><span class="n">p</span><span class="p">))</span>                       <span class="cm">/* release mmapped memory. */</span>
    <span class="p">{</span>
      <span class="cm">/* See if the dynamic brk/mmap threshold needs adjusting.
         Dumped fake mmapped chunks do not affect the threshold.  */</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">mp_</span><span class="p">.</span><span class="n">no_dyn_threshold</span>
          <span class="o">&amp;&amp;</span> <span class="n">chunksize_nomask</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">mp_</span><span class="p">.</span><span class="n">mmap_threshold</span>
          <span class="o">&amp;&amp;</span> <span class="n">chunksize_nomask</span> <span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">DEFAULT_MMAP_THRESHOLD_MAX</span>
          <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">DUMPED_MAIN_ARENA_CHUNK</span> <span class="p">(</span><span class="n">p</span><span class="p">))</span>
        <span class="p">{</span>
          <span class="n">mp_</span><span class="p">.</span><span class="n">mmap_threshold</span> <span class="o">=</span> <span class="n">chunksize</span> <span class="p">(</span><span class="n">p</span><span class="p">);</span>
          <span class="n">mp_</span><span class="p">.</span><span class="n">trim_threshold</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mp_</span><span class="p">.</span><span class="n">mmap_threshold</span><span class="p">;</span>
          <span class="n">LIBC_PROBE</span> <span class="p">(</span><span class="n">memory_mallopt_free_dyn_thresholds</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                      <span class="n">mp_</span><span class="p">.</span><span class="n">mmap_threshold</span><span class="p">,</span> <span class="n">mp_</span><span class="p">.</span><span class="n">trim_threshold</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="n">munmap_chunk</span> <span class="p">(</span><span class="n">p</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>Therefore, we need to trigger <code class="highlighter-rouge">malloc_trim(0)</code> from our python code written above; which we can easily do using <code class="highlighter-rouge">ctypes</code> module.
<br /><br />
The fixed implementation looks like this:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">ctypes</span> <span class="kn">import</span> <span class="n">cdll</span><span class="p">,</span> <span class="n">CDLL</span>
<span class="n">cdll</span><span class="o">.</span><span class="n">LoadLibrary</span><span class="p">(</span><span class="s">"libc.so.6"</span><span class="p">)</span>
<span class="n">libc</span> <span class="o">=</span> <span class="n">CDLL</span><span class="p">(</span><span class="s">"libc.so.6"</span><span class="p">)</span>
<span class="n">libc</span><span class="o">.</span><span class="n">malloc_trim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">blast</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">libc</span><span class="o">.</span><span class="n">malloc_trim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">blast</span><span class="p">()</span>
</code></pre></div></div>
<p><br />
In another solution, I tried forcing the GC using python’s <code class="highlighter-rouge">gc</code> module; which gave the results similar to above method.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">gc</span>

<span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10000000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">blast</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">xs</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span> <span class="c1"># Forced GC
</span>
<span class="n">blast</span><span class="p">()</span>
</code></pre></div></div>
<p><br />
The distrubution of Memory usage w.r.t Time looked much better now, and there was almost no difference in execution time. (see the “dark blue” line)</p>
<p><img class="img-responsive" src="http://localhost:3000/assets/images/pandas_memory_leak_fix.png" alt="Pandas memory leak with fix" /></p>

<p><br /><br />
Similar cases, References and other notes:</p>
<ol>
  <li>Even after doing <code class="highlighter-rouge">low_memory=False</code> while reading a CSV using <code class="highlighter-rouge">pandas.read_csv</code>, it crashes with <code class="highlighter-rouge">MemoryError</code> exception, even though the CSV is not bigger than the RAM.</li>
  <li>Explanation of malloc(), calloc(), free(), realloc() deserves a separate post altogether. I’ll post that soon.</li>
  <li>Similar reported issues:<br />
     - https://github.com/pandas-dev/pandas/issues/2659<br />
     - https://github.com/pandas-dev/pandas/issues/21353<br /></li>
</ol>

 ]]></content>
</entry>


  <entry>
  <title type="text">Running - The Bangalore airport solo Half Marathon 2018 - 26 km</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2018/12/30/running-the-bangalore-airport-solo-half-marathon-26-km.html" />
  <id>http://localhost:3000/blog/2018/12/30/running-the-bangalore-airport-solo-half-marathon-26-km</id>
  <published>2018-12-30T00:00:00Z</published>
  <updated>2018-12-30T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>WIP.</p>
 ]]></content>
</entry>


  <entry>
  <title type="text">Cycling - Completed 3824 km of cycling in an year</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2018/08/18/completed-3824-km-cycling-in-an-year.html" />
  <id>http://localhost:3000/blog/2018/08/18/completed-3824-km-cycling-in-an-year</id>
  <published>2018-08-18T00:00:00Z</published>
  <updated>2018-08-18T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>
Exactly an year back, I started cycling for commute, endurance rides and a bunch of amazing trips. It feels good to have completed 3824 km in last one year. The goal is to be consistent with this, and keep cycling :)
</p>
<p><br /></p>
<center><img class="img-responsive" src="http://localhost:3000/assets/images/cycling_3824km_in_an_year.png" alt="cycling_3824km_in_an_year" style="width:600px;height:450px;" />
</center>

<p><br />
This cycle is Montra Madrock MTB.</p>
 ]]></content>
</entry>


  <entry>
  <title type="text">Pyspark&amp;#58; Why you should write UDFs in Scala/Java</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2018/08/17/spark-udf-in-scala-java-for-pyspark.html" />
  <id>http://localhost:3000/blog/2018/08/17/spark-udf-in-scala-java-for-pyspark</id>
  <published>2018-08-17T00:00:00Z</published>
  <updated>2018-08-17T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>While writing Pyspark programs, we would generally write UDFs in Python, which is a very obvious thing to do. However, the performance of Python UDFs are not as good as those written in Scala/Java.</p>

<p>Spark is written in Scala and Data/objects of a Spark program are stored in JVM. Pyspark API is just a wrapper over SparkSession, RDDs/DataFrame and other JVM objects (a few parts are in native python as well). This means that a Pyspark program goes through serialization and deserialization of JVM objects and data. This back and forth conversion affects the performance of Pyspark program drastically. Pyspark UDFs are a good example where this conversion happens a lot.</p>

<p><br />
<b>Example Implementation</b>:</p>

<p>Here is a very simple Java UDF to count length of a string:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.rootcss</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.spark.sql.api.java.UDF1</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SparkJavaUdfExample</span> <span class="kd">implements</span> <span class="no">UDF1</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">Integer</span> <span class="nf">call</span><span class="o">(</span><span class="nc">String</span> <span class="n">input</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">input</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>
<p>(full Java code is available here: https://github.com/rootcss/PysparkJavaUdfExample)
<br /><br /></p>

<p>Once compiled, you can start pyspark by including the jar in the path.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/pyspark <span class="nt">--jars</span> /path/to/target/SparkJavaUdfExample-1.0-SNAPSHOT.jar
</code></pre></div></div>
<p><br /></p>

<p>Here’s the usage in Pyspark:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> from pyspark.sql.types import IntegerType
<span class="o">&gt;&gt;&gt;</span> <span class="c"># Now, register the UDF in Pyspark</span>
<span class="o">&gt;&gt;&gt;</span> sqlContext.registerJavaFunction<span class="o">(</span><span class="s2">"myCustomUdf"</span>, <span class="s2">"com.rootcss.SparkJavaUdfExample"</span>, IntegerType<span class="o">())</span>
<span class="o">&gt;&gt;&gt;</span> spark.sql<span class="o">(</span><span class="s2">"SELECT myCustomUdf('shekhar')"</span><span class="o">)</span>.collect<span class="o">()</span>
+------------+
|UDF<span class="o">(</span>shekhar<span class="o">)</span>|
+------------+
|           7|
+------------+
</code></pre></div></div>

<p><br />
<b>References</b>:</p>
<ul>
  <li>Slide #59 in https://0x0fff.com/wp-content/uploads/2015/11/Spark-Architecture-JD-Kiev-v04.pdf</li>
  <li>This post covers this whole topic in more details - https://medium.com/wbaa/using-scala-udfs-in-pyspark-b70033dd69b9</li>
</ul>

 ]]></content>
</entry>


  <entry>
  <title type="text">Using Cloudflare's SSL for your website (FREE!)</title>
  <link rel="alternate" type="text/html" href="http://localhost:3000//blog/2018/08/16/using-cloudflare-s-ssl-for-your-website-free.html" />
  <id>http://localhost:3000/blog/2018/08/16/using-cloudflare-s-ssl-for-your-website-free</id>
  <published>2018-08-16T00:00:00Z</published>
  <updated>2018-08-16T00:00:00Z</updated>
  <content type="html"><![CDATA[ <p>Many people who have static websites/blogs would say, they don’t really need SSL for their website and I’ve said that too in past. SSL certificates are not cheap comparatively and we try to save that additional cost.</p>

<p>Internet Providers have been playing around with the web traffic and tampering it for a while now. Sniffing the traffic and content injection in web pages is common. These are some simple examples for why SSL is important.</p>

<p>Coming to the point, <a target="_blank" href="https://www.cloudflare.com/">Cloudflare</a> provides free SSL for your website, and it’s super-easy to configure:</p>
<ul>
  <li>Sign up on Cloudflare and enter your DNS. After that, they will automatically fetch all the DNS Records associated with your domain. You can cross-check from your domain provider to be sure.</li>
  <li>In the next step, they will provide few (usually 2) new Nameservers (something like blah.ns.cloudflare.com)</li>
  <li>You just need to replace the existing Nameservers with these new ones in your Domain provider’s dashboard.</li>
  <li>Wait for DNS resolution to complete. Meanwhile, go to Cloudflare dashboard’s Crypto menu, and Turn ON <b>Always use HTTPS</b> option.</li>
  <li>Once you see <b>Universal SSL Status: Active Certificate</b> in the dashboard, your website will have working SSL. (happend for me within 5 minutes; but might take upto 24 hours)</li>
</ul>

<p><br />
<b>How does it work?</b></p>

<p>Cloudflare has three ways in which you can use SSL.</p>
<ul>
  <li><b>Flexible SSL</b>: Traffic between User &amp; Cloudflare is over HTTPS, but only HTTP between Cloudflare and your server.</li>
  <li><b>Full SSL</b>: If your server is configured with SSL, then the traffic is end to end over HTTPS. In my case, my website is hosted on Github Pages, which is configured with SSL, so I chose this option.</li>
  <li><b>Full SSL (Strict)</b>: Same as Full SSL, but additionally, the connection between Cloudflare &amp; web server is authenticated for every request as well. This needs a signed certificate from a trusted authority.</li>
</ul>

<p>You can <a target="_blank" href="https://support.cloudflare.com/hc/en-us/articles/200170416">read more</a> about it in Cloudflare’s official documentation.</p>

<p>Cloudflare also provides a lot of other useful features like Caching, Firewall to name a few.</p>

<p>PS: I got to know about Cloudflare’s free SSL plan today. Thank you Cloudflare.</p>

<p><b>References:</b></p>
<ul>
  <li>https://support.cloudflare.com/hc/en-us/articles/200170416</li>
  <li>https://www.cloudflare.com/</li>
</ul>
 ]]></content>
</entry>



</feed>
